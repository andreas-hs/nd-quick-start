# Laravel App

## Оптимізація RabbitMQ

[RabbitMQService.php](nd-laravel-app/app/Services/RabbitMQService.php)

1. **Пакетна відправка повідомлень**: Замість відправлення кожного повідомлення окремо використовується пакетна
   відправка, що значно зменшує кількість мережевих запитів і підвищує загальну ефективність системи.

2. **Prefetch Count**: Більша кількість повідомлень може оброблятись одночасно, що прискорює процес споживання
   повідомлень.

3. **Manual режим підтвердження**: Це дозволяє підтверджувати пакет повідомлень, що знижує час на роботу з RabbitMQ.

4. **Асинхронна публікація**: Повідомлення відправляються асинхронно, що зменшує очікування підтвердження для кожного
   повідомлення перед відправкою наступного.

5. **Dead-Letter Exchange (DLX) і TTL (Time-to-Live)**: Для обробки повідомлень, що не вдалося доставити,
   використовується черга з Dead-Letter Exchange (DLX) та параметром TTL. Це підвищує надійність обробки повідомлень.

#### Результати оптимізації

| Показник          | Синхронно, без batch | Асинхронно, з batch | Різниця (секунди) | Різниця (%) |
|-------------------|----------------------|---------------------|-------------------|-------------|
| **Загальний час** | 15.06 секунд         | 3.03 секунди        | 12.03 секунд      | **79.9%**   |
| **Час RabbitMQ**  | 14.59 секунд         | 0.48 секунд         | 14.11 секунд      | **96.7%**   |

## Використання транзакцій та пакетної вставки (Batch Insert) в Seeder

[SourceDataSeeder.php](nd-laravel-app/database/seeders/SourceDataSeeder.php)

Транзакції групують кілька операцій у одну, що забезпечує:

1. **Цілісність даних**: Якщо виникає помилка, всі операції відміняються.
2. **Швидкість**: Транзакції прискорюють вставку, зменшуючи кількість фіксацій (`commit`). У нашому випадку це дає
   приріст швидкості на **приблизно 4.65%** або **140 мс** для вставки 10,000 записів:
    - **Без транзакції**: 2.974 сек.
    - **З транзакцією**: 2.836 сек.

#### Чому не перевіряємо максимальний розмір строки запиту?

1. **Пакетна вставка**: Ми вставляємо дані пакетами по **1,000 записів**, що не наближає нас до лімітів MySQL.
2. **Достатньо для задачі**: Поточний підхід з батчами оптимізує вставку і не потребує додаткових перевірок в рамках
   тестової задачі.
